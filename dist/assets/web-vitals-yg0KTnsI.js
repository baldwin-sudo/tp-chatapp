let B=-1;const h=e=>{addEventListener("pageshow",(t=>{t.persisted&&(B=t.timeStamp,e(t))}),!0)},l=(e,t,i,r)=>{let n,s;return o=>{t.value>=0&&(o||r)&&(s=t.value-(n??0),(s||n===void 0)&&(n=t.value,t.delta=s,t.rating=((a,c)=>a>c[1]?"poor":a>c[0]?"needs-improvement":"good")(t.value,i),e(t)))}},y=e=>{requestAnimationFrame((()=>requestAnimationFrame((()=>e()))))},C=()=>{const e=performance.getEntriesByType("navigation")[0];if(e&&e.responseStart>0&&e.responseStart<performance.now())return e},v=()=>C()?.activationStart??0,u=(e,t=-1)=>{const i=C();let r="navigate";return B>=0?r="back-forward-cache":i&&(document.prerendering||v()>0?r="prerender":document.wasDiscarded?r="restore":i.type&&(r=i.type.replace(/_/g,"-"))),{name:e,value:t,rating:"good",delta:0,entries:[],id:`v5-${Date.now()}-${Math.floor(8999999999999*Math.random())+1e12}`,navigationType:r}},g=new WeakMap;function H(e,t){return g.get(e)||g.set(e,new t),g.get(e)}class x{t;i=0;o=[];h(t){if(t.hadRecentInput)return;const i=this.o[0],r=this.o.at(-1);this.i&&i&&r&&t.startTime-r.startTime<1e3&&t.startTime-i.startTime<5e3?(this.i+=t.value,this.o.push(t)):(this.i=t.value,this.o=[t]),this.t?.(t)}}const b=(e,t,i={})=>{try{if(PerformanceObserver.supportedEntryTypes.includes(e)){const r=new PerformanceObserver((n=>{Promise.resolve().then((()=>{t(n.getEntries())}))}));return r.observe({type:e,buffered:!0,...i}),r}}catch{}},L=e=>{let t=!1;return()=>{t||(e(),t=!0)}};let p=-1;const M=new Set,w=()=>document.visibilityState!=="hidden"||document.prerendering?1/0:0,f=e=>{if(document.visibilityState==="hidden"){if(e.type==="visibilitychange")for(const t of M)t();isFinite(p)||(p=e.type==="visibilitychange"?e.timeStamp:0,removeEventListener("prerenderingchange",f,!0))}},S=()=>{if(p<0){const e=v();p=(document.prerendering?void 0:globalThis.performance.getEntriesByType("visibility-state").filter((i=>i.name==="hidden"&&i.startTime>e))[0]?.startTime)??w(),addEventListener("visibilitychange",f,!0),addEventListener("prerenderingchange",f,!0),h((()=>{setTimeout((()=>{p=w()}))}))}return{get firstHiddenTime(){return p},onHidden(e){M.add(e)}}},E=e=>{document.prerendering?addEventListener("prerenderingchange",(()=>e()),!0):e()},A=[1800,3e3],q=(e,t={})=>{E((()=>{const i=S();let r,n=u("FCP");const s=b("paint",(o=>{for(const a of o)a.name==="first-contentful-paint"&&(s.disconnect(),a.startTime<i.firstHiddenTime&&(n.value=Math.max(a.startTime-v(),0),n.entries.push(a),r(!0)))}));s&&(r=l(e,n,A,t.reportAllChanges),h((o=>{n=u("FCP"),r=l(e,n,A,t.reportAllChanges),y((()=>{n.value=performance.now()-o.timeStamp,r(!0)}))})))}))},F=[.1,.25],$=(e,t={})=>{const i=S();q(L((()=>{let r,n=u("CLS",0);const s=H(t,x),o=c=>{for(const d of c)s.h(d);s.i>n.value&&(n.value=s.i,n.entries=s.o,r())},a=b("layout-shift",o);a&&(r=l(e,n,F,t.reportAllChanges),i.onHidden((()=>{o(a.takeRecords()),r(!0)})),h((()=>{s.i=0,n=u("CLS",0),r=l(e,n,F,t.reportAllChanges),y((()=>r()))})),setTimeout(r))})))},O=e=>{const t=globalThis.requestIdleCallback||setTimeout;document.visibilityState==="hidden"?e():(e=L(e),addEventListener("visibilitychange",e,{once:!0,capture:!0}),t((()=>{e(),removeEventListener("visibilitychange",e,{capture:!0})})))};class R{m;h(t){this.m?.(t)}}const P=[2500,4e3],D=(e,t={})=>{E((()=>{const i=S();let r,n=u("LCP");const s=H(t,R),o=c=>{t.reportAllChanges||(c=c.slice(-1));for(const d of c)s.h(d),d.startTime<i.firstHiddenTime&&(n.value=Math.max(d.startTime-v(),0),n.entries=[d],r())},a=b("largest-contentful-paint",o);if(a){r=l(e,n,P,t.reportAllChanges);const c=L((()=>{o(a.takeRecords()),a.disconnect(),r(!0)})),d=m=>{m.isTrusted&&(O(c),removeEventListener(m.type,d,{capture:!0}))};for(const m of["keydown","click","visibilitychange"])addEventListener(m,d,{capture:!0});h((m=>{n=u("LCP"),r=l(e,n,P,t.reportAllChanges),y((()=>{n.value=performance.now()-m.timeStamp,r(!0)}))}))}}))},k=[800,1800],T=e=>{document.prerendering?E((()=>T(e))):document.readyState!=="complete"?addEventListener("load",(()=>T(e)),!0):setTimeout(e)},I=(e,t={})=>{let i=u("TTFB"),r=l(e,i,k,t.reportAllChanges);T((()=>{const n=C();n&&(i.value=Math.max(n.responseStart-v(),0),i.entries=[n],r(!0),h((()=>{i=u("TTFB",0),r=l(e,i,k,t.reportAllChanges),r(!0)})))}))};export{F as CLSThresholds,A as FCPThresholds,P as LCPThresholds,k as TTFBThresholds,$ as onCLS,q as onFCP,D as onLCP,I as onTTFB};
